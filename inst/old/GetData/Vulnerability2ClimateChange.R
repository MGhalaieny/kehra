################################################################################
######################## Vulnerability To Climate Change #######################
################################################################################

# According to:
# https://www.globalcreditportal.com/ratingsdirect/renderArticle.do?articleId=1318252&SctArtId=236925&from=CM&nsl_code=LIME&sourceObjectId=8606813&sourceRevId=1&fee_ind=N&exp_date=20240514-20:34:43

setwd('~/Dropbox/Projects/kehra')
# Get list of nuclear test sites from Wikipedia's page

# Code adapted from Carson Sievert's examples:
# http://cpsievert.github.io/slides/web-scraping
library(rvest)
theurl <- "https://www.globalcreditportal.com/ratingsdirect/renderArticle.do?articleId=1318252&SctArtId=236925&from=CM&nsl_code=LIME&sourceObjectId=8606813&sourceRevId=1&fee_ind=N&exp_date=20240514-20:34:43"
# First, grab the page source
content <- read_html(theurl) %>%
  # then extract the first node with class of wikitable
  html_node(".article") %>% 
  # then convert the HTML table into a data frame
  html_table(header=FALSE, fill=TRUE)

# Overall ranking
Ranking <- as.numeric(content[4:119,1])

# Sovereign	
Sovereign <- as.character(content[4:119,2])

# Population living below five meters altitude (2000)	
# rank
PopulationR <- as.numeric(content[4:119,3])
# index
PopulationI <- as.numeric(content[4:119,4])

# Agriculture as share of GDP (2012)	
# rank
AgricultureR <- as.numeric(content[4:119,5])
# index
AgricultureI <- as.numeric(content[4:119,6])

# GAIN Vulnerability Index (2012)
# rank
VulnerabilityR <- as.numeric(content[4:119,7])
# index
VulnerabilityI <- as.numeric(content[4:119,8])

df <- data.frame(Ranking, Sovereign, 
                 PopulationR, PopulationI,
                 AgricultureR, AgricultureI,
                 VulnerabilityR, VulnerabilityI)

saveRDS(df, "~/Dropbox/Projects/kehra/data/LookUpTables/VulnerabilityIndex.rds")

plot(df$VulnerabilityI ~ df$Ranking, xlab="Ranking", ylab="Vulnerability Index")
KZ <- df[df$Sovereign=="Kazakhstan",]
points(KZ$VulnerabilityI ~ KZ$Ranking, col="red", pch=20, cex= 1.5)
UK <- df[df$Sovereign=="U.K.",]
points(UK$VulnerabilityI ~ UK$Ranking, col="blue", pch=20, cex= 1.5)
legend("topleft", pch = 20, col=c("red","blue"), legend=c("KZ","UK"))

rm(theurl, content, Ranking, Sovereign, PopulationR, PopulationI, AgricultureR, 
   AgricultureI, VulnerabilityR, VulnerabilityI)