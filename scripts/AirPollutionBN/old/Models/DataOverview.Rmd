---
title: "Data overview"
author: "Claudia Vitolo"
date: "9 November 2015"
output: html_document
---

# Data overview
Collate data from databases on pollution, climate and mortality/morbidity.

```{r}
rm(list = ls())

df0 <- readRDS("~/Dropbox/Projects/kehra/data/Pollution/allPollutantsClima.rds")

```

Let's just consider PM10 and climate variables:

```{r}
df <- df0[,-c(9:13)]

summary(df0$TEMP)
#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 274.2   281.9   286.1   286.2   290.5   299.9 
summary(df0$PM10)
#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
#  2.00   19.00   26.00   31.91   38.00  733.00   24359

summary(df[,8:13])

```

PM10 contains many NA, let's see if removing the NA records causes a change in distributions over the other variables.

```{r}
# Remove the rows with PM10 = NA
df <- df[!is.na(df$PM10),]

# Compare distributions
boxplot(df0[,"TEMP"],df[,"TEMP"])

# NO difference! It's safe to remove the NAs.

```

The temperature looks like normally distributed (symmetrical, no points over the wiskers). What about PM10?

```{r}
boxplot(df[,"PM10"])

library(moments) 
skewness(df$TEMP)
skewness(df$PM10)
```

PM10 looks right skewed, let's transform it using the log. This is safe because there are no values less than or equal to zero (the minimum is 2), therefore no NA will be generated during the transformation. If there were zeros or nergative values, a constant could be added to the argument of the logarithm (caution, this could change the interpretation!!!). See this post for a [Skewness Minimising Transform:](http://rstudio-pubs-static.s3.amazonaws.com/1563_1ae2544c0e324b9bb7f6e63cf8f9e098.html).

```{r}
df$PM10 <- log(df$PM10)

boxplot(df$PM10)
```

Alternatively we could standardise all the variables by simply calculating the mean and sd and using the formula:

$z = (mean - x)/sd$

Repeat similar cleanup for the other variables.

```{r}
mean_covariates <- apply(df[,7:18],2,mean)
sd_covariates <- apply(df[,7:18],2,sd)
df[,7:18] <- scale(x = df[,7:18], center = mean_covariates, scale = sd_covariates)
# i <- 18; summary(df[,i]); plot(df[,i], main=names(df)[i])
```

```{r}
saveRDS(df, "~/Dropbox/Projects/kehra/data/datasetAfterCleanup.rds")
```

```{r}
library(geoR)
# ?geoR
data(SIC)
# points(sic.100, borders=sic.borders)

library(gstat)
# ?gstat
data(sic97) 
# image(demstd)
# points(sic_full, pch=1)
# points(sic_obs, pch=3)

mesh <- inla.mesh.create.helper(points=sic.100$data,
                                points.domain=sic.borders, 
                                offset=c(5, 20), 
                                max.edge=c(40,100),
                                min.angle=c(21,21))
```


From Chapter 5

```{r}

```